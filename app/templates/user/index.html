{% extends "private_app_layout.html" %}
{% block title %}Usuarios{% endblock %}
{% block head %}
  {{ super() }}
{% endblock %}
{% block content %}
  <h1>Usuarios</h1>
  <table class="table">
    <thead>
        <tr>
            <th scope="col" class="text-center">Roles</th>
            <th scope="col" class="text-center">email</th>
            <th scope="col" class="text-center">Nombre</th>
            <th scope="col" class="text-center">Apellido</th>
            <th scope="col" class="text-center">Estado</th>
            <th scope="col" class="text-center">Acciones</th>
        </tr>
    </thead>

    <tbody>
      {% for user in users.items %}
      <tr>
          <td class="text-center">
            {% for rol in user.roles %}
              {{rol.name}},
            {% endfor %}
          </td>
          <td class="text-center">{{user.email}}</td>
          <td class="text-center">{{user.first_name}}</td>
          <td class="text-center">{{user.last_name}}</td>
          {% if user.active == 1 %}
            {% set buttonText = 'Bloquear' %}
            <td class="text-center">Activo</td> 
          {% else %} 
            {% set buttonText = 'Desbloquear' %}
            <td class="text-center">Bloqueado</td>  
          {% endif %}
          <td class="text-center d-flex">
              {% if not helper_has_role(user.roles, "rol_administrador") %}
                <form  action="{{ url_for('user.toggle_state') }}" method="POST">
                  <input name="user_id" type="hidden" value="{{user.id}}">
                  <input name="state" type="hidden" value="{{user.active}}">
                  <button class="button-gradient" type="submit">{{buttonText}}</button>
                </form>
              {% endif %}
              <a class="nav-link" href="{{url_for('user.edit', user_id=user.id)}}">Editar</a>
          </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <nav aria-label="Page navigation example">
    <ul class="pagination justify-content-center">
      {% if users.has_prev %}
        <li class="page-item"></li>
        <a class="page-link" href="{{url_for('user.index', page_number=users.prev_num)}}" tabindex="-1">Anterior</a>
      {% else %}
        <li class="page-item disabled">
        <a class="page-link" href="#" tabindex="-1">Anterior</a>
      {% endif %}
      </li>
        {% for page in users.iter_pages() %}
            {% if page %}
              <li class="page-item"><a class="page-link" href="{{url_for('user.index', page_number=page)}}">{{ page }}</a></li>
            {% endif %}
        {% endfor %}
      {% if users.has_next %}
        <li class="page-item"></li>
        <a class="page-link" href="{{url_for('user.index', page_number=users.next_num)}}">Siguiente</a>
      {% else %}
        <li class="page-item disabled">
        <a class="page-link" href="#">Siguiente</a>
      {% endif %}
    </ul>
  </nav>

  <a href="{{url_for('home.index')}}" class="link">Volver</a>      
  <a href="{{url_for('user.new')}}" class="link">Nuevo</a>  
{% endblock %}